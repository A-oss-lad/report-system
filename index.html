<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>江西粤东气象社区交流安全中心 - 首页</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1e40af',
                        secondary: '#3b82f6',
                        accent: '#60a5fa',
                        neutral: '#f3f4f6',
                        'neutral-dark': '#9ca3af',
                        success: '#10b981',
                        warning: '#f59e0b',
                        danger: '#ef4444',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    boxShadow: {
                        'card': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
                        'card-hover': '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .glass-effect {
                background: rgba(255, 255, 255, 0.7);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
            .transition-all-300 {
                transition: all 0.3s ease;
            }
            .card-hover {
                transition: all 0.3s ease;
            }
            .card-hover:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen pb-20">
    <!-- 顶部导航栏 -->
    <header class="bg-primary text-white shadow-md">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center">
                <i class="fa fa-shield text-xl mr-2"></i>
                <h1 class="text-lg font-bold">江西粤东气象社区交流安全中心</h1>
            </div>
            <div class="flex items-center">
                <button id="logout-btn" class="text-white hover:text-gray-200 transition-all-300 flex items-center">
                    <i class="fa fa-sign-out mr-1"></i> 退出
                </button>
            </div>
        </div>
    </header>

    <!-- 主要内容区域 -->
    <main class="container mx-auto px-4 py-6">
        <!-- 欢迎信息 -->
        <section class="mb-8">
            <div class="bg-white rounded-xl shadow-card p-6">
                <div class="flex items-center mb-4">
                    <div class="w-12 h-12 rounded-full bg-primary text-white flex items-center justify-center text-xl">
                        <i class="fa fa-user"></i>
                    </div>
                    <div class="ml-4">
                        <h2 class="text-xl font-bold text-gray-800" id="welcome-message">欢迎回来，用户</h2>
                        <p class="text-neutral-dark" id="login-time">上次登录时间：未知</p>
                    </div>
                </div>
                <p class="text-gray-600">
                    欢迎来到江西粤东气象社区交流安全中心。本中心致力于维护社区交流环境的安全与规范，
                    为广大气象爱好者提供一个健康、和谐的交流平台。如有任何问题或发现违规行为，请及时举报。
                </p>
            </div>
        </section>

        <!-- 公告栏 -->
        <section class="mb-8">
            <div class="bg-white rounded-xl shadow-card p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-bold text-gray-800 flex items-center">
                        <i class="fa fa-bullhorn text-primary mr-2"></i>
                        最新公告
                    </h2>
                    <span class="text-xs text-neutral-dark">更多 <i class="fa fa-angle-right"></i></span>
                </div>
                <div id="announcements-container">
                    <!-- 公告内容将通过JavaScript动态生成 -->
                    <div class="border-l-4 border-primary pl-4 py-2 mb-3">
                        <h3 class="font-medium text-gray-800">欢迎使用江西粤东气象社区交流安全中心</h3>
                        <p class="text-sm text-gray-600 mt-1">本中心已正式上线，为社区用户提供举报、申诉等服务，共同维护社区环境。</p>
                        <p class="text-xs text-neutral-dark mt-2">2023-07-01</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 快捷功能 -->
        <section class="mb-8">
            <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                <i class="fa fa-star text-primary mr-2"></i>
                快捷功能
            </h2>
            <div class="grid grid-cols-2 gap-4">
                <a href="report.html" class="bg-white rounded-xl shadow-card p-6 flex flex-col items-center justify-center card-hover">
                    <div class="w-16 h-16 rounded-full bg-red-100 text-red-500 flex items-center justify-center text-2xl mb-3">
                        <i class="fa fa-flag"></i>
                    </div>
                    <h3 class="font-medium text-gray-800">我要举报</h3>
                    <p class="text-xs text-neutral-dark mt-1 text-center">举报违规行为</p>
                </a>
                <a href="progress.html" class="bg-white rounded-xl shadow-card p-6 flex flex-col items-center justify-center card-hover">
                    <div class="w-16 h-16 rounded-full bg-blue-100 text-blue-500 flex items-center justify-center text-2xl mb-3">
                        <i class="fa fa-tasks"></i>
                    </div>
                    <h3 class="font-medium text-gray-800">处理进度</h3>
                    <p class="text-xs text-neutral-dark mt-1 text-center">查看举报处理状态</p>
                </a>
                <a href="notice.html" class="bg-white rounded-xl shadow-card p-6 flex flex-col items-center justify-center card-hover">
                    <div class="w-16 h-16 rounded-full bg-yellow-100 text-yellow-500 flex items-center justify-center text-2xl mb-3">
                        <i class="fa fa-bell"></i>
                    </div>
                    <h3 class="font-medium text-gray-800">处罚通知</h3>
                    <p class="text-xs text-neutral-dark mt-1 text-center">查看违规处罚通知</p>
                </a>
                <a href="user-center.html" class="bg-white rounded-xl shadow-card p-6 flex flex-col items-center justify-center card-hover">
                    <div class="w-16 h-16 rounded-full bg-green-100 text-green-500 flex items-center justify-center text-2xl mb-3">
                        <i class="fa fa-user-circle"></i>
                    </div>
                    <h3 class="font-medium text-gray-800">个人中心</h3>
                    <p class="text-xs text-neutral-dark mt-1 text-center">查看个人信息</p>
                </a>
            </div>
        </section>

        <!-- 社区规则摘要 -->
        <section class="mb-8">
            <div class="bg-white rounded-xl shadow-card p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-bold text-gray-800 flex items-center">
                        <i class="fa fa-book text-primary mr-2"></i>
                        社区规则摘要
                    </h2>
                    <a href="more.html" class="text-xs text-primary hover:text-blue-700 transition-all-300 flex items-center">
                        查看全部 <i class="fa fa-angle-right ml-1"></i>
                    </a>
                </div>
                <div class="space-y-4">
                    <div>
                        <h3 class="font-medium text-gray-800 mb-2">江西粤东气象社区交流规范</h3>
                        <ul class="text-sm text-gray-600 space-y-1 list-disc list-inside">
                            <li>遵守国家法律法规和社会主义核心价值观</li>
                            <li>尊重他人，友善交流，禁止辱骂、侮辱他人</li>
                            <li>禁止发布色情、暴力、血腥等不良内容</li>
                            <li>禁止发布政治敏感信息和谣言</li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="font-medium text-gray-800 mb-2">QQ群聊交流规范</h3>
                        <ul class="text-sm text-gray-600 space-y-1 list-disc list-inside">
                            <li>群聊内容应以气象相关话题为主</li>
                            <li>禁止在群内发布广告、推广等无关信息</li>
                            <li>禁止在群内争吵、辱骂他人</li>
                            <li>尊重群管理员，服从管理</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- 底部导航栏 -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white shadow-lg border-t border-gray-200 z-10">
        <div class="flex justify-around">
            <a href="index.html" class="flex flex-col items-center py-3 px-4 text-primary">
                <i class="fa fa-home text-xl"></i>
                <span class="text-xs mt-1">首页</span>
            </a>
            <a href="report.html?skipLogin=true" class="flex flex-col items-center py-3 px-4 text-neutral-dark hover:text-primary transition-all-300">
                <i class="fa fa-flag text-xl"></i>
                <span class="text-xs mt-1">我要举报</span>
            </a>
            <a href="progress.html?skipLogin=true" class="flex flex-col items-center py-3 px-4 text-neutral-dark hover:text-primary transition-all-300">
                <i class="fa fa-tasks text-xl"></i>
                <span class="text-xs mt-1">处理进度</span>
            </a>
            <a href="more.html?skipLogin=true" class="flex flex-col items-center py-3 px-4 text-neutral-dark hover:text-primary transition-all-300">
                <i class="fa fa-ellipsis-h text-xl"></i>
                <span class="text-xs mt-1">更多</span>
            </a>
            <a href="user-center.html?skipLogin=true" class="flex flex-col items-center py-3 px-4 text-neutral-dark hover:text-primary transition-all-300">
                <i class="fa fa-user text-xl"></i>
                <span class="text-xs mt-1">我</span>
            </a>
        </div>
    </nav>

    <script>
        // 检查本地存储是否可用
        function isStorageAvailable(type) {
            try {
                const storage = window[type];
                const x = '__storage_test__';
                storage.setItem(x, x);
                storage.removeItem(x);
                return true;
            } catch (e) {
                return false;
            }
        }

        // 检查用户是否已登录
        function checkLogin() {
            // 检查URL参数，如果有skipLogin=true，则直接返回模拟用户
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('skipLogin') && urlParams.get('skipLogin') === 'true') {
                console.log('跳过登录检查，使用模拟用户');
                return createMockUser();
            }
            
            // 检查sessionStorage是否可用
            if (!isStorageAvailable('sessionStorage')) {
                console.warn('sessionStorage不可用，使用模拟登录状态');
                return createMockUser();
            }
            
            const currentUser = sessionStorage.getItem('currentUser');
            if (!currentUser) {
                // 尝试从URL参数获取登录状态
                if (urlParams.has('loggedIn') && urlParams.get('loggedIn') === 'true') {
                    return createMockUser();
                }
                
                // 用户未登录，显示提示信息而不是跳转
                showLoginPrompt();
                return createMockUser(); // 返回模拟用户以显示页面
            }
            
            try {
                return JSON.parse(currentUser);
            } catch (e) {
                console.error('解析用户数据失败', e);
                return createMockUser();
            }
        }
        
        // 显示登录提示
        function showLoginPrompt() {
            const promptDiv = document.createElement('div');
            promptDiv.className = 'fixed top-0 left-0 right-0 bg-yellow-50 border-b border-yellow-200 text-yellow-800 p-3 text-center z-50';
            promptDiv.innerHTML = `
                <div class="container mx-auto flex items-center justify-center">
                    <i class="fa fa-info-circle mr-2"></i>
                    <span>您正在以访客模式浏览，部分功能可能受限。</span>
                    <a href="login.html" class="ml-3 bg-primary text-white px-3 py-1 rounded text-sm hover:bg-blue-700 transition-colors">
                        登录
                    </a>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-gray-500 hover:text-gray-700">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
            `;
            document.body.insertBefore(promptDiv, document.body.firstChild);
        }

        // 创建模拟用户数据
        function createMockUser() {
            return {
                id: 'user-001',
                username: '测试用户',
                qqNumber: '123456789',
                role: 'user'
            };
        }

        // 获取用户最后登录时间
        function getLastLoginTime(userId) {
            // 检查localStorage是否可用
            if (!isStorageAvailable('localStorage')) {
                return new Date().toLocaleString('zh-CN');
            }
            
            try {
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const user = users.find(u => u.id === userId);
                if (user && user.lastLoginTime) {
                    return new Date(user.lastLoginTime).toLocaleString('zh-CN');
                }
            } catch (e) {
                console.error('获取登录时间失败', e);
            }
            return new Date().toLocaleString('zh-CN');
        }

        // 加载公告
        function loadAnnouncements() {
            const container = document.getElementById('announcements-container');
            
            // 默认公告内容
            const defaultAnnouncements = [
                {
                    title: '欢迎使用江西粤东气象社区交流安全中心',
                    content: '本中心已正式上线，为社区用户提供举报、申诉等服务，共同维护社区环境。',
                    createTime: '2023-07-01'
                },
                {
                    title: '社区规则更新通知',
                    content: '近期我们更新了社区交流规范，请所有用户仔细阅读并遵守，共同维护良好的交流环境。',
                    createTime: '2023-06-15'
                },
                {
                    title: '系统功能优化',
                    content: '我们对举报处理流程进行了优化，现在处理速度更快，反馈更及时。',
                    createTime: '2023-06-01'
                }
            ];
            
            // 尝试从localStorage加载公告
            if (isStorageAvailable('localStorage')) {
                try {
                    const announcements = JSON.parse(localStorage.getItem('announcements')) || [];
                    if (announcements.length > 0) {
                        // 显示最新的3条公告
                        const latestAnnouncements = announcements
                            .filter(a => a.isActive !== false)
                            .sort((a, b) => new Date(b.createTime) - new Date(a.createTime))
                            .slice(0, 3);
                        
                        container.innerHTML = latestAnnouncements.map(announcement => `
                            <div class="border-l-4 border-primary pl-4 py-2 mb-3">
                                <h3 class="font-medium text-gray-800">${announcement.title}</h3>
                                <p class="text-sm text-gray-600 mt-1">${announcement.content.substring(0, 100)}${announcement.content.length > 100 ? '...' : ''}</p>
                                <p class="text-xs text-neutral-dark mt-2">${new Date(announcement.createTime).toLocaleDateString('zh-CN')}</p>
                            </div>
                        `).join('');
                        return;
                    }
                } catch (e) {
                    console.error('加载公告失败', e);
                }
            }
            
            // 如果没有公告或加载失败，显示默认公告
            container.innerHTML = defaultAnnouncements.map(announcement => `
                <div class="border-l-4 border-primary pl-4 py-2 mb-3">
                    <h3 class="font-medium text-gray-800">${announcement.title}</h3>
                    <p class="text-sm text-gray-600 mt-1">${announcement.content}</p>
                    <p class="text-xs text-neutral-dark mt-2">${announcement.createTime}</p>
                </div>
            `).join('');
        }

        // 页面加载时执行
        document.addEventListener('DOMContentLoaded', () => {
            try {
                const user = checkLogin();
                if (user) {
                    // 更新欢迎信息
                    const welcomeElement = document.getElementById('welcome-message');
                    const loginTimeElement = document.getElementById('login-time');
                    
                    if (welcomeElement) {
                        welcomeElement.textContent = `欢迎回来，${user.username}`;
                    }
                    
                    if (loginTimeElement) {
                        loginTimeElement.textContent = `上次登录时间：${getLastLoginTime(user.id)}`;
                    }
                    
                    // 加载公告
                    loadAnnouncements();
                }
            } catch (e) {
                console.error('页面初始化失败', e);
                // 即使出错也要显示基本内容
                loadAnnouncements();
            }
            
            // 退出登录按钮点击事件
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', () => {
                    if (isStorageAvailable('sessionStorage')) {
                        sessionStorage.removeItem('currentUser');
                    }
                    window.location.href = 'login.html';
                });
            }
        });
    </script>
</body>
</html>